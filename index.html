<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pembelajaran Gaya Antarmolekul</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .molecule {
      cursor: grab;
      transition: transform 0.1s;
    }
    
    .molecule:active {
      cursor: grabbing;
    }
    
    .molecule-solid {
      animation: vibrate 0.5s infinite;
    }
    
    @keyframes vibrate {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-1px, -1px); }
      50% { transform: translate(1px, 1px); }
      75% { transform: translate(-1px, 1px); }
    }
    
    .molecule-liquid {
      animation: drift 3s infinite ease-in-out;
    }
    
    @keyframes drift {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(10px, -10px); }
    }
    
    .molecule-gas {
      animation: fly 2s infinite linear;
    }
    
    @keyframes fly {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, -50px); }
    }
    
    .interaction-line {
      stroke-dasharray: 5, 5;
      animation: dash 0.5s linear infinite;
    }
    
    @keyframes dash {
      to { stroke-dashoffset: -10; }
    }
    
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .accordion-content.open {
      max-height: 500px;
    }
    
    .toast {
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .glossary-sidebar {
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .glossary-sidebar.open {
      transform: translateX(0);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full">
  <div id="app"></div>
  <script>
    // Konfigurasi default
    const defaultConfig = {
      title: "Gaya Antarmolekul & Sifat Fisika Zat",
      subtitle: "Pembelajaran Interaktif Kimia",
      primary_color: "#2563eb",
      secondary_color: "#a855f7",
      accent_color: "#22c55e",
      background_color: "#f9fafb",
      text_color: "#111827",
      font_family: "system-ui",
      font_size: 16
    };

    let config = { ...defaultConfig };

    // Data senyawa untuk lab virtual
    const compoundsData = {
      'H‚ÇÇO': { name: 'Air', meltingPoint: 0, boilingPoint: 100, type: 'Ikatan Hidrogen', strength: 'Kuat' },
      'NH‚ÇÉ': { name: 'Amonia', meltingPoint: -78, boilingPoint: -33, type: 'Ikatan Hidrogen', strength: 'Kuat' },
      'HF': { name: 'Hidrogen Fluorida', meltingPoint: -83, boilingPoint: 20, type: 'Ikatan Hidrogen', strength: 'Sangat Kuat' },
      'CH‚ÇÑ': { name: 'Metana', meltingPoint: -182, boilingPoint: -164, type: 'Gaya London', strength: 'Lemah' },
      'C‚ÇÇH‚ÇÜ': { name: 'Etana', meltingPoint: -183, boilingPoint: -89, type: 'Gaya London', strength: 'Lemah' },
      'C‚ÇÉH‚Çà': { name: 'Propana', meltingPoint: -188, boilingPoint: -42, type: 'Gaya London', strength: 'Sedang' },
      'HCl': { name: 'Asam Klorida', meltingPoint: -114, boilingPoint: -85, type: 'Dipol-Dipol', strength: 'Sedang' },
      'HBr': { name: 'Asam Bromida', meltingPoint: -87, boilingPoint: -67, type: 'Dipol-Dipol', strength: 'Sedang' },
      'Cl‚ÇÇ': { name: 'Klorin', meltingPoint: -102, boilingPoint: -34, type: 'Gaya London', strength: 'Sedang' },
      'Br‚ÇÇ': { name: 'Bromin', meltingPoint: -7, boilingPoint: 59, type: 'Gaya London', strength: 'Sedang' }
    };

    // Data interaksi molekul
    const moleculeInteractions = {
      'H‚ÇÇO-H‚ÇÇO': { type: 'Ikatan Hidrogen', strength: 'Kuat', description: 'O-H...O membentuk ikatan hidrogen sangat kuat' },
      'H‚ÇÇO-NH‚ÇÉ': { type: 'Ikatan Hidrogen', strength: 'Kuat', description: 'O-H...N membentuk ikatan hidrogen' },
      'H‚ÇÇO-HCl': { type: 'Dipol-Dipol', strength: 'Sedang', description: 'Interaksi antara molekul polar' },
      'NH‚ÇÉ-NH‚ÇÉ': { type: 'Ikatan Hidrogen', strength: 'Kuat', description: 'N-H...N membentuk ikatan hidrogen' },
      'NH‚ÇÉ-HCl': { type: 'Dipol-Dipol', strength: 'Sedang', description: 'Interaksi polar kuat' },
      'CH‚ÇÑ-CH‚ÇÑ': { type: 'Gaya London', strength: 'Lemah', description: 'Gaya dispersi antar molekul nonpolar' },
      'CH‚ÇÑ-CO‚ÇÇ': { type: 'Gaya London', strength: 'Lemah', description: 'Gaya dispersi lemah' },
      'HCl-HCl': { type: 'Dipol-Dipol', strength: 'Sedang', description: 'Interaksi dipol permanen' },
      'CO‚ÇÇ-CO‚ÇÇ': { type: 'Gaya London', strength: 'Lemah', description: 'Gaya dispersi pada molekul linear' }
    };

    // State management
    let state = {
      activeTab: 'materi',
      darkMode: false,
      openAccordion: null,
      molecules: [
        { id: 'H‚ÇÇO', x: 50, y: 50, color: '#3b82f6', label: 'H‚ÇÇO' },
        { id: 'NH‚ÇÉ', x: 150, y: 50, color: '#8b5cf6', label: 'NH‚ÇÉ' },
        { id: 'CH‚ÇÑ', x: 250, y: 50, color: '#22c55e', label: 'CH‚ÇÑ' },
        { id: 'HCl', x: 350, y: 50, color: '#f59e0b', label: 'HCl' },
        { id: 'CO‚ÇÇ', x: 450, y: 50, color: '#ef4444', label: 'CO‚ÇÇ' }
      ],
      dragging: null,
      interactions: [],
      interactionCount: 0,
      selectedCompound: 'H‚ÇÇO',
      temperature: 25,
      progress: { materi: false, simulasi: false, lab: false },
      showGlossary: false,
      toasts: []
    };

    // Fungsi untuk menghitung jarak antara dua molekul
    function calculateDistance(mol1, mol2) {
      const dx = mol1.x - mol2.x;
      const dy = mol1.y - mol2.y;
      return Math.sqrt(dx * dx + dy * dy);
    }

    // Fungsi untuk mendeteksi interaksi
    function detectInteractions() {
      const newInteractions = [];
      const molecules = state.molecules;
      
      for (let i = 0; i < molecules.length; i++) {
        for (let j = i + 1; j < molecules.length; j++) {
          const distance = calculateDistance(molecules[i], molecules[j]);
          if (distance < 100) {
            const key1 = `${molecules[i].id}-${molecules[j].id}`;
            const key2 = `${molecules[j].id}-${molecules[i].id}`;
            const interaction = moleculeInteractions[key1] || moleculeInteractions[key2];
            
            if (interaction) {
              newInteractions.push({
                mol1: molecules[i],
                mol2: molecules[j],
                ...interaction
              });
            }
          }
        }
      }
      
      // Update interaction count jika ada interaksi baru
      if (newInteractions.length > state.interactions.length) {
        state.interactionCount++;
        if (state.interactionCount === 5 && !state.progress.simulasi) {
          state.progress.simulasi = true;
          showToast('üéâ Pencapaian: Menemukan 5 interaksi molekul!');
        }
      }
      
      state.interactions = newInteractions;
    }

    // Fungsi untuk menentukan fase berdasarkan suhu
    function getPhase(compound, temp) {
      const data = compoundsData[compound];
      if (temp < data.meltingPoint) return 'solid';
      if (temp < data.boilingPoint) return 'liquid';
      return 'gas';
    }

    // Fungsi untuk menampilkan toast
    function showToast(message) {
      const id = Date.now();
      state.toasts.push({ id, message });
      render();
      
      setTimeout(() => {
        state.toasts = state.toasts.filter(t => t.id !== id);
        render();
      }, 3000);
    }

    // Fungsi render utama
    function render() {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      
      const bgColor = state.darkMode ? '#111827' : (config.background_color || defaultConfig.background_color);
      const textColor = state.darkMode ? '#f9fafb' : (config.text_color || defaultConfig.text_color);
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      
      const app = document.getElementById('app');
      app.style.fontFamily = fontFamily;
      app.style.backgroundColor = bgColor;
      app.style.color = textColor;
      
      const phase = getPhase(state.selectedCompound, state.temperature);
      
      app.innerHTML = `
        <!-- Header -->
        <header class="sticky top-0 z-40 shadow-lg" style="background-color: ${primaryColor};">
          <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
              <div>
                <h1 class="text-white font-bold" style="font-size: ${baseSize * 1.75}px;">${config.title || defaultConfig.title}</h1>
                <p class="text-white opacity-90" style="font-size: ${baseSize * 0.875}px;">${config.subtitle || defaultConfig.subtitle}</p>
              </div>
              <div class="flex gap-3 items-center">
                <button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition text-white">
                  ${state.darkMode ? '‚òÄÔ∏è' : 'üåô'}
                </button>
                <button onclick="toggleGlossary()" class="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition text-white" style="font-size: ${baseSize * 0.875}px;">
                  üìö Glosarium
                </button>
              </div>
            </div>
            
            <!-- Progress Tracker -->
            <div class="mt-4 flex gap-2">
              <div class="flex-1 h-2 rounded-full ${state.progress.materi ? 'bg-white' : 'bg-white bg-opacity-30'}"></div>
              <div class="flex-1 h-2 rounded-full ${state.progress.simulasi ? 'bg-white' : 'bg-white bg-opacity-30'}"></div>
              <div class="flex-1 h-2 rounded-full ${state.progress.lab ? 'bg-white' : 'bg-white bg-opacity-30'}"></div>
            </div>
          </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="sticky top-20 z-30 shadow" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
          <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-1">
              <button onclick="switchTab('materi')" class="flex-1 py-4 font-semibold transition border-b-4 ${state.activeTab === 'materi' ? 'border-current' : 'border-transparent opacity-60'}" style="color: ${primaryColor}; font-size: ${baseSize}px;">
                üìñ Materi Pengantar
              </button>
              <button onclick="switchTab('simulasi')" class="flex-1 py-4 font-semibold transition border-b-4 ${state.activeTab === 'simulasi' ? 'border-current' : 'border-transparent opacity-60'}" style="color: ${secondaryColor}; font-size: ${baseSize}px;">
                üî¨ Simulasi Molekul
              </button>
              <button onclick="switchTab('lab')" class="flex-1 py-4 font-semibold transition border-b-4 ${state.activeTab === 'lab' ? 'border-current' : 'border-transparent opacity-60'}" style="color: ${accentColor}; font-size: ${baseSize}px;">
                üß™ Lab Virtual
              </button>
            </div>
          </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
          ${state.activeTab === 'materi' ? renderMateri() : ''}
          ${state.activeTab === 'simulasi' ? renderSimulasi() : ''}
          ${state.activeTab === 'lab' ? renderLab() : ''}
        </main>

        <!-- Glossary Sidebar -->
        <div class="fixed inset-0 z-50 pointer-events-none">
          <div onclick="toggleGlossary()" class="absolute inset-0 bg-black transition-opacity ${state.showGlossary ? 'opacity-50 pointer-events-auto' : 'opacity-0'}"></div>
          <div class="glossary-sidebar ${state.showGlossary ? 'open' : ''} absolute right-0 top-0 h-full w-80 shadow-2xl overflow-y-auto pointer-events-auto" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
            <div class="p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold" style="font-size: ${baseSize * 1.5}px;">üìö Glosarium</h3>
                <button onclick="toggleGlossary()" class="text-2xl">&times;</button>
              </div>
              <div class="space-y-4">
                <div class="p-4 rounded-lg" style="background-color: ${state.darkMode ? '#374151' : '#f3f4f6'};">
                  <h4 class="font-semibold mb-2" style="font-size: ${baseSize * 1.125}px;">Gaya London</h4>
                  <p style="font-size: ${baseSize * 0.875}px;">Gaya tarik-menarik lemah antara molekul nonpolar akibat dipol sesaat.</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: ${state.darkMode ? '#374151' : '#f3f4f6'};">
                  <h4 class="font-semibold mb-2" style="font-size: ${baseSize * 1.125}px;">Dipol-Dipol</h4>
                  <p style="font-size: ${baseSize * 0.875}px;">Interaksi antara molekul polar dengan dipol permanen.</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: ${state.darkMode ? '#374151' : '#f3f4f6'};">
                  <h4 class="font-semibold mb-2" style="font-size: ${baseSize * 1.125}px;">Ikatan Hidrogen</h4>
                  <p style="font-size: ${baseSize * 0.875}px;">Interaksi kuat antara H dengan atom elektronegatif (F, O, N).</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: ${state.darkMode ? '#374151' : '#f3f4f6'};">
                  <h4 class="font-semibold mb-2" style="font-size: ${baseSize * 1.125}px;">Titik Didih</h4>
                  <p style="font-size: ${baseSize * 0.875}px;">Suhu saat tekanan uap zat cair sama dengan tekanan atmosfer.</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: ${state.darkMode ? '#374151' : '#f3f4f6'};">
                  <h4 class="font-semibold mb-2" style="font-size: ${baseSize * 1.125}px;">Titik Beku</h4>
                  <p style="font-size: ${baseSize * 0.875}px;">Suhu saat zat cair berubah menjadi padat.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Toast Notifications -->
        <div class="fixed bottom-4 right-4 z-50 space-y-2">
          ${state.toasts.map(toast => `
            <div class="toast px-6 py-4 rounded-lg shadow-lg text-white" style="background-color: ${accentColor}; font-size: ${baseSize * 0.875}px;">
              ${toast.message}
            </div>
          `).join('')}
        </div>
      `;
      
      // Setup event listeners untuk simulasi
      if (state.activeTab === 'simulasi') {
        setupSimulationListeners();
      }
      
      // Setup event listeners untuk lab
      if (state.activeTab === 'lab') {
        setupLabListeners();
      }
    }

    function renderMateri() {
      const baseSize = config.font_size || defaultConfig.font_size;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      
      const accordions = [
        {
          id: 'definisi',
          title: 'Definisi Gaya Antarmolekul',
          color: primaryColor,
          content: 'Gaya antarmolekul adalah gaya tarik-menarik atau tolak-menolak yang terjadi antara molekul-molekul. Gaya ini lebih lemah dibandingkan ikatan kimia intramolekul, namun sangat mempengaruhi sifat fisika zat seperti titik didih, titik beku, dan kelarutan.'
        },
        {
          id: 'jenis',
          title: 'Jenis-Jenis Gaya Antarmolekul',
          color: secondaryColor,
          content: `
            <div class="space-y-3">
              <div class="p-3 rounded-lg" style="background-color: ${primaryColor}20;">
                <h5 class="font-semibold mb-1" style="color: ${primaryColor};">1. Gaya London (Dispersi)</h5>
                <p class="text-sm">Gaya terlemah, terjadi pada semua molekul. Contoh: CH‚ÇÑ, CO‚ÇÇ, Cl‚ÇÇ</p>
              </div>
              <div class="p-3 rounded-lg" style="background-color: ${secondaryColor}20;">
                <h5 class="font-semibold mb-1" style="color: ${secondaryColor};">2. Dipol-Dipol</h5>
                <p class="text-sm">Terjadi antara molekul polar. Contoh: HCl, HBr, SO‚ÇÇ</p>
              </div>
              <div class="p-3 rounded-lg" style="background-color: ${accentColor}20;">
                <h5 class="font-semibold mb-1" style="color: ${accentColor};">3. Ikatan Hidrogen</h5>
                <p class="text-sm">Gaya terkuat, H berikatan dengan F, O, atau N. Contoh: H‚ÇÇO, NH‚ÇÉ, HF</p>
              </div>
            </div>
          `
        },
        {
          id: 'faktor',
          title: 'Faktor yang Mempengaruhi Kekuatan',
          color: accentColor,
          content: `
            <ul class="list-disc list-inside space-y-2 text-sm">
              <li><strong>Massa molekul relatif:</strong> Semakin besar massa, semakin kuat gaya London</li>
              <li><strong>Polaritas molekul:</strong> Molekul polar memiliki gaya dipol-dipol</li>
              <li><strong>Kemampuan membentuk ikatan hidrogen:</strong> Molekul dengan H-F, H-O, H-N paling kuat</li>
              <li><strong>Bentuk molekul:</strong> Molekul linear memiliki luas permukaan kontak lebih besar</li>
            </ul>
          `
        },
        {
          id: 'hubungan',
          title: 'Hubungan dengan Sifat Fisika',
          color: primaryColor,
          content: `
            <div class="space-y-2 text-sm">
              <p><strong>Titik Didih & Titik Beku:</strong> Semakin kuat gaya antarmolekul, semakin tinggi titik didih dan titik beku.</p>
              <p><strong>Viskositas:</strong> Gaya antarmolekul kuat menghasilkan viskositas tinggi.</p>
              <p><strong>Tegangan Permukaan:</strong> Air memiliki tegangan permukaan tinggi karena ikatan hidrogen.</p>
              <p><strong>Kelarutan:</strong> "Like dissolves like" - polar larut dalam polar, nonpolar dalam nonpolar.</p>
            </div>
          `
        }
      ];
      
      return `
        <div class="grid gap-4">
          ${accordions.map(acc => `
            <div class="rounded-lg shadow-lg overflow-hidden" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'}; border-left: 4px solid ${acc.color};">
              <button onclick="toggleAccordion('${acc.id}')" class="w-full p-4 flex justify-between items-center hover:opacity-80 transition">
                <span class="font-semibold" style="font-size: ${baseSize * 1.125}px; color: ${acc.color};">${acc.title}</span>
                <span class="text-2xl">${state.openAccordion === acc.id ? '‚àí' : '+'}</span>
              </button>
              <div class="accordion-content ${state.openAccordion === acc.id ? 'open' : ''}" style="font-size: ${baseSize * 0.875}px;">
                <div class="p-4 pt-0">
                  ${acc.content}
                </div>
              </div>
            </div>
          `).join('')}
          
          <button onclick="completeMateri()" class="mt-4 w-full py-3 rounded-lg font-semibold text-white transition hover:opacity-90" style="background-color: ${primaryColor}; font-size: ${baseSize}px;">
            ‚úì Selesai Mempelajari Materi
          </button>
        </div>
      `;
    }

    function renderSimulasi() {
      const baseSize = config.font_size || defaultConfig.font_size;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      
      return `
        <div class="space-y-6">
          <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-bold" style="font-size: ${baseSize * 1.5}px;">Simulasi Interaksi Molekul</h3>
              <div class="flex gap-3 items-center">
                <span class="px-4 py-2 rounded-lg font-semibold" style="background-color: ${secondaryColor}20; color: ${secondaryColor}; font-size: ${baseSize * 0.875}px;">
                  Interaksi: ${state.interactionCount}
                </span>
                <button onclick="resetSimulation()" class="px-4 py-2 rounded-lg font-semibold text-white transition hover:opacity-90" style="background-color: ${secondaryColor}; font-size: ${baseSize * 0.875}px;">
                  üîÑ Reset
                </button>
              </div>
            </div>
            
            <p class="mb-4 opacity-75" style="font-size: ${baseSize * 0.875}px;">
              Seret molekul untuk mendekatkannya. Ketika jarak < 100px, garis interaksi akan muncul!
            </p>
            
            <div class="relative rounded-lg overflow-hidden" style="background: linear-gradient(135deg, ${state.darkMode ? '#374151' : '#e5e7eb'} 0%, ${state.darkMode ? '#1f2937' : '#f3f4f6'} 100%);">
              <svg id="simulation-canvas" width="100%" height="400" style="max-width: 600px; display: block; margin: 0 auto;">
                <!-- Interaction lines -->
                ${state.interactions.map(int => `
                  <line 
                    x1="${int.mol1.x + 30}" 
                    y1="${int.mol1.y + 30}" 
                    x2="${int.mol2.x + 30}" 
                    y2="${int.mol2.y + 30}" 
                    stroke="${int.strength === 'Kuat' ? '#22c55e' : int.strength === 'Sedang' ? '#f59e0b' : '#ef4444'}" 
                    stroke-width="2" 
                    class="interaction-line"
                  />
                `).join('')}
                
                <!-- Molecules -->
                ${state.molecules.map(mol => `
                  <g class="molecule" data-id="${mol.id}" style="cursor: grab;">
                    <circle cx="${mol.x + 30}" cy="${mol.y + 30}" r="28" fill="${mol.color}" opacity="0.9" />
                    <text x="${mol.x + 30}" y="${mol.y + 35}" text-anchor="middle" fill="white" font-weight="bold" font-size="14" style="pointer-events: none;">
                      ${mol.label}
                    </text>
                  </g>
                `).join('')}
              </svg>
              
              <!-- Tooltips -->
              ${state.interactions.map((int, idx) => `
                <div class="absolute px-3 py-2 rounded-lg shadow-lg text-white text-xs" style="background-color: ${int.strength === 'Kuat' ? '#22c55e' : int.strength === 'Sedang' ? '#f59e0b' : '#ef4444'}; left: ${(int.mol1.x + int.mol2.x) / 2 + 30}px; top: ${(int.mol1.y + int.mol2.y) / 2 - 40}px; transform: translate(-50%, -100%);">
                  <div class="font-semibold">${int.type}</div>
                  <div>Kekuatan: ${int.strength}</div>
                  <div class="text-xs opacity-90">${int.description}</div>
                </div>
              `).join('')}
            </div>
            
            <!-- Legend -->
            <div class="mt-6 grid grid-cols-5 gap-3">
              ${state.molecules.map(mol => `
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded-full" style="background-color: ${mol.color};"></div>
                  <span style="font-size: ${baseSize * 0.75}px;">${mol.label}</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderLab() {
      const baseSize = config.font_size || defaultConfig.font_size;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const phase = getPhase(state.selectedCompound, state.temperature);
      const compoundData = compoundsData[state.selectedCompound];
      
      // Generate molecule positions based on phase
      const moleculePositions = [];
      if (phase === 'solid') {
        for (let i = 0; i < 5; i++) {
          for (let j = 0; j < 5; j++) {
            moleculePositions.push({ x: 50 + i * 60, y: 50 + j * 60 });
          }
        }
      } else if (phase === 'liquid') {
        for (let i = 0; i < 25; i++) {
          moleculePositions.push({
            x: 40 + Math.random() * 320,
            y: 40 + Math.random() * 260
          });
        }
      } else {
        for (let i = 0; i < 25; i++) {
          moleculePositions.push({
            x: 20 + Math.random() * 360,
            y: 20 + Math.random() * 300
          });
        }
      }
      
      return `
        <div class="grid lg:grid-cols-2 gap-6">
          <!-- Left Column: Controls -->
          <div class="space-y-6">
            <!-- Compound Selector -->
            <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
              <label class="block font-semibold mb-3" style="font-size: ${baseSize * 1.125}px;">Pilih Senyawa</label>
              <select id="compound-select" class="w-full p-3 rounded-lg border-2 transition" style="font-size: ${baseSize}px; background-color: ${state.darkMode ? '#374151' : '#f9fafb'}; border-color: ${accentColor};">
                ${Object.keys(compoundsData).map(key => `
                  <option value="${key}" ${state.selectedCompound === key ? 'selected' : ''}>${key} - ${compoundsData[key].name}</option>
                `).join('')}
              </select>
            </div>
            
            <!-- Compound Info -->
            <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
              <h4 class="font-bold mb-4" style="font-size: ${baseSize * 1.25}px;">${state.selectedCompound} - ${compoundData.name}</h4>
              <div class="space-y-3" style="font-size: ${baseSize * 0.875}px;">
                <div class="flex justify-between">
                  <span class="opacity-75">Titik Beku:</span>
                  <span class="font-semibold">${compoundData.meltingPoint}¬∞C</span>
                </div>
                <div class="flex justify-between">
                  <span class="opacity-75">Titik Didih:</span>
                  <span class="font-semibold">${compoundData.boilingPoint}¬∞C</span>
                </div>
                <div class="flex justify-between">
                  <span class="opacity-75">Jenis Gaya:</span>
                  <span class="font-semibold">${compoundData.type}</span>
                </div>
                <div class="flex justify-between">
                  <span class="opacity-75">Kekuatan:</span>
                  <span class="font-semibold">${compoundData.strength}</span>
                </div>
              </div>
            </div>
            
            <!-- Temperature Control -->
            <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
              <label class="block font-semibold mb-3" style="font-size: ${baseSize * 1.125}px;">Suhu: ${state.temperature}¬∞C</label>
              <input 
                type="range" 
                id="temperature-slider" 
                min="-200" 
                max="150" 
                value="${state.temperature}" 
                class="w-full h-3 rounded-lg appearance-none cursor-pointer"
                style="background: linear-gradient(to right, #3b82f6 0%, #ef4444 100%);"
              />
              <div class="flex justify-between mt-2 text-xs opacity-75">
                <span>-200¬∞C</span>
                <span>150¬∞C</span>
              </div>
            </div>
            
            <!-- Chart -->
            <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
              <h4 class="font-semibold mb-4" style="font-size: ${baseSize * 1.125}px;">Perbandingan Titik Didih</h4>
              <div class="space-y-2">
                ${Object.entries(compoundsData).map(([key, data]) => {
                  const maxBoiling = 100;
                  const width = ((data.boilingPoint + 200) / 350) * 100;
                  const isActive = key === state.selectedCompound;
                  return `
                    <div>
                      <div class="flex justify-between text-xs mb-1">
                        <span class="${isActive ? 'font-bold' : ''}" style="color: ${isActive ? accentColor : 'inherit'};">${key}</span>
                        <span>${data.boilingPoint}¬∞C</span>
                      </div>
                      <div class="h-6 rounded-full overflow-hidden" style="background-color: ${state.darkMode ? '#374151' : '#e5e7eb'};">
                        <div class="h-full transition-all duration-500 ${isActive ? 'opacity-100' : 'opacity-60'}" style="width: ${width}%; background-color: ${isActive ? accentColor : '#9ca3af'};"></div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>
          
          <!-- Right Column: Animation -->
          <div class="space-y-6">
            <div class="rounded-lg shadow-lg p-6" style="background-color: ${state.darkMode ? '#1f2937' : '#ffffff'};">
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold" style="font-size: ${baseSize * 1.25}px;">Fase: ${phase === 'solid' ? 'Padat ‚ùÑÔ∏è' : phase === 'liquid' ? 'Cair üíß' : 'Gas ‚òÅÔ∏è'}</h4>
                <div class="px-4 py-2 rounded-lg font-semibold text-white" style="background-color: ${accentColor}; font-size: ${baseSize * 0.875}px;">
                  ${state.temperature}¬∞C
                </div>
              </div>
              
              <!-- Thermometer -->
              <div class="flex gap-4 mb-6">
                <div class="w-12 rounded-full overflow-hidden" style="background-color: ${state.darkMode ? '#374151' : '#e5e7eb'};">
                  <div class="transition-all duration-500" style="height: ${((state.temperature + 200) / 350) * 100}%; background: linear-gradient(to top, #3b82f6, #ef4444); margin-top: ${100 - ((state.temperature + 200) / 350) * 100}%;"></div>
                </div>
                <div class="flex-1">
                  <div class="text-sm opacity-75 mb-2">Rentang Fase:</div>
                  <div class="space-y-1 text-xs">
                    <div class="flex items-center gap-2">
                      <div class="w-3 h-3 rounded-full" style="background-color: #3b82f6;"></div>
                      <span>Padat: < ${compoundData.meltingPoint}¬∞C</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-3 h-3 rounded-full" style="background-color: #8b5cf6;"></div>
                      <span>Cair: ${compoundData.meltingPoint}¬∞C - ${compoundData.boilingPoint}¬∞C</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-3 h-3 rounded-full" style="background-color: #ef4444;"></div>
                      <span>Gas: > ${compoundData.boilingPoint}¬∞C</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Molecule Animation -->
              <div class="relative rounded-lg overflow-hidden" style="height: 340px; background: linear-gradient(135deg, ${state.darkMode ? '#374151' : '#e5e7eb'} 0%, ${state.darkMode ? '#1f2937' : '#f3f4f6'} 100%);">
                <svg width="100%" height="100%" style="max-width: 400px; display: block; margin: 0 auto;">
                  ${moleculePositions.map((pos, idx) => `
                    <circle 
                      cx="${pos.x}" 
                      cy="${pos.y}" 
                      r="${phase === 'solid' ? '8' : phase === 'liquid' ? '6' : '4'}" 
                      fill="${accentColor}" 
                      opacity="${phase === 'solid' ? '0.9' : phase === 'liquid' ? '0.7' : '0.5'}"
                      class="${phase === 'solid' ? 'molecule-solid' : phase === 'liquid' ? 'molecule-liquid' : 'molecule-gas'}"
                      style="animation-delay: ${idx * 0.05}s;"
                    />
                  `).join('')}
                </svg>
                
                <div class="absolute bottom-4 left-4 right-4 p-3 rounded-lg text-white text-sm" style="background-color: rgba(0,0,0,0.7);">
                  ${phase === 'solid' ? '‚ùÑÔ∏è Molekul bergetar di tempat dengan jarak tetap' : 
                    phase === 'liquid' ? 'üíß Molekul bergerak bebas namun masih berdekatan' : 
                    '‚òÅÔ∏è Molekul bergerak sangat cepat dan berjauhan'}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function setupSimulationListeners() {
      const svg = document.getElementById('simulation-canvas');
      if (!svg) return;
      
      const molecules = svg.querySelectorAll('.molecule');
      
      molecules.forEach(mol => {
        mol.addEventListener('mousedown', startDrag);
      });
      
      svg.addEventListener('mousemove', drag);
      svg.addEventListener('mouseup', endDrag);
      svg.addEventListener('mouseleave', endDrag);
    }

    function startDrag(e) {
      const id = e.currentTarget.dataset.id;
      const molecule = state.molecules.find(m => m.id === id);
      if (!molecule) return;
      
      const svg = document.getElementById('simulation-canvas');
      const rect = svg.getBoundingClientRect();
      
      state.dragging = {
        id: id,
        offsetX: e.clientX - rect.left - molecule.x - 30,
        offsetY: e.clientY - rect.top - molecule.y - 30
      };
      
      e.currentTarget.style.cursor = 'grabbing';
    }

    function drag(e) {
      if (!state.dragging) return;
      
      const svg = document.getElementById('simulation-canvas');
      const rect = svg.getBoundingClientRect();
      
      const molecule = state.molecules.find(m => m.id === state.dragging.id);
      if (!molecule) return;
      
      molecule.x = Math.max(0, Math.min(540, e.clientX - rect.left - state.dragging.offsetX - 30));
      molecule.y = Math.max(0, Math.min(340, e.clientY - rect.top - state.dragging.offsetY - 30));
      
      detectInteractions();
      render();
    }

    function endDrag(e) {
      if (state.dragging) {
        const mol = document.querySelector(`[data-id="${state.dragging.id}"]`);
        if (mol) mol.style.cursor = 'grab';
        state.dragging = null;
      }
    }

    function setupLabListeners() {
      const compoundSelect = document.getElementById('compound-select');
      const tempSlider = document.getElementById('temperature-slider');
      
      if (compoundSelect) {
        compoundSelect.addEventListener('change', (e) => {
          state.selectedCompound = e.target.value;
          if (!state.progress.lab) {
            state.progress.lab = true;
            showToast('üéâ Pencapaian: Menyelesaikan Lab Virtual!');
          }
          render();
        });
      }
      
      if (tempSlider) {
        tempSlider.addEventListener('input', (e) => {
          state.temperature = parseInt(e.target.value);
          render();
        });
      }
    }

    function switchTab(tab) {
      state.activeTab = tab;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggleAccordion(id) {
      state.openAccordion = state.openAccordion === id ? null : id;
      render();
    }

    function toggleDarkMode() {
      state.darkMode = !state.darkMode;
      render();
    }

    function toggleGlossary() {
      state.showGlossary = !state.showGlossary;
      render();
    }

    function resetSimulation() {
      state.molecules = [
        { id: 'H‚ÇÇO', x: 50, y: 50, color: '#3b82f6', label: 'H‚ÇÇO' },
        { id: 'NH‚ÇÉ', x: 150, y: 50, color: '#8b5cf6', label: 'NH‚ÇÉ' },
        { id: 'CH‚ÇÑ', x: 250, y: 50, color: '#22c55e', label: 'CH‚ÇÑ' },
        { id: 'HCl', x: 350, y: 50, color: '#f59e0b', label: 'HCl' },
        { id: 'CO‚ÇÇ', x: 450, y: 50, color: '#ef4444', label: 'CO‚ÇÇ' }
      ];
      state.interactions = [];
      state.interactionCount = 0;
      render();
    }

    function completeMateri() {
      if (!state.progress.materi) {
        state.progress.materi = true;
        showToast('üéâ Pencapaian: Menyelesaikan Materi Pengantar!');
      }
      state.activeTab = 'simulasi';
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Element SDK implementation
    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      render();
    }

    const capabilities = {
      recolorables: [
        {
          get: () => config.background_color || defaultConfig.background_color,
          set: (value) => {
            config.background_color = value;
            window.elementSdk.setConfig({ background_color: value });
          }
        },
        {
          get: () => config.text_color || defaultConfig.text_color,
          set: (value) => {
            config.text_color = value;
            window.elementSdk.setConfig({ text_color: value });
          }
        },
        {
          get: () => config.primary_color || defaultConfig.primary_color,
          set: (value) => {
            config.primary_color = value;
            window.elementSdk.setConfig({ primary_color: value });
          }
        },
        {
          get: () => config.secondary_color || defaultConfig.secondary_color,
          set: (value) => {
            config.secondary_color = value;
            window.elementSdk.setConfig({ secondary_color: value });
          }
        },
        {
          get: () => config.accent_color || defaultConfig.accent_color,
          set: (value) => {
            config.accent_color = value;
            window.elementSdk.setConfig({ accent_color: value });
          }
        }
      ],
      borderables: [],
      fontEditable: {
        get: () => config.font_family || defaultConfig.font_family,
        set: (value) => {
          config.font_family = value;
          window.elementSdk.setConfig({ font_family: value });
        }
      },
      fontSizeable: {
        get: () => config.font_size || defaultConfig.font_size,
        set: (value) => {
          config.font_size = value;
          window.elementSdk.setConfig({ font_size: value });
        }
      }
    };

    function mapToEditPanelValues(config) {
      return new Map([
        ["title", config.title || defaultConfig.title],
        ["subtitle", config.subtitle || defaultConfig.subtitle]
      ]);
    }

    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: () => capabilities,
        mapToEditPanelValues
      });
    }

    // Initial render
    render();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99ccda8020b21333',t:'MTc2Mjg1NDI5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>